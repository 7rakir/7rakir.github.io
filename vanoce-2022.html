<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Demo - The Web's Sixth Sense: A Study of Scripts Accessing Smartphone Sensors</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <title>JavaScript Sensor Access Demo</title>
  <style>
    #demo-div {
      color: lightgrey;
      border-radius: 0.3rem;
    }

    #demo-div span,
    #demo-div #num-observed-events {
      color: black;
    }

    h1 {
      margin-top: 0.5rem;
    }

    h4 {
      margin-top: 0.66rem;
      font-size: 1.33rem;
    }

    #demo-div li {
      line-height: 21px;
    }

    #demo-div ul {
      margin-bottom: 0.66rem;
    }
  </style>
</head>

<body>
  <main role="main" class="container">

    <div class="p-3 mb-2 bg-secondary" id="demo-div">
      <a id="start_demo" class="btn btn-lg btn-success py-1" href="#" role="button">Start the demo</a>

      <h4 style="margin-top:0.75rem;">Orientation</h4>
      <ul>
        <li>X-axis (&beta;): <span id="Orientation_b">0</span><span>&deg;</span></li>
        <li>Y-axis (&gamma;): <span id="Orientation_g">0</span><span>&deg;</span></li>
        <li>Z-axis (&alpha;): <span id="Orientation_a">0</span><span>&deg;</span></li>
      </ul>

    </div>
  </main>
  <script>

    function handleOrientation(event) {
      updateFieldIfNotNull('Orientation_a', event.alpha);
      updateFieldIfNotNull('Orientation_b', event.beta);
      updateFieldIfNotNull('Orientation_g', event.gamma);

      var multiplied = Math.abs(event.alpha * event.beta * event.gamma);
      var low = multiplied < 1 ? 1 : multiplied;
      var log = Math.log(low) * 10;
      var limit = log > 50 ? 50 : log;
      updateFilter(limit);
    }

    function updateFieldIfNotNull(fieldName, value, precision = 1) {
      if (value != null)
        document.getElementById(fieldName).innerHTML = value.toFixed(precision);
    }

    let demo_button = document.getElementById("start_demo");

    var audio = new Audio();
    audio.controls = true;
    audio.loop = true;
    audio.crossOrigin = "anonymous";

    let filter;

    function updateFilter(value) {
      filter.gain.value = value;
    }

    demo_button.onclick = function (e) {
      e.preventDefault();


      //////////////////

      audio.src = ".\\ttsMP3.com_VoiceText_2022-12-3_13_21_39.mp3";
      document.getElementById('demo-div').appendChild(audio);
      audio.autoplay = true;


      const audioContext = new AudioContext();
      filter = audioContext.createBiquadFilter();
      filter.type = "lowshelf";
      filter.frequency.value = 370;
      filter.gain.value = 50;

      const audioSource = audioContext.createMediaElementSource(audio);

      audioSource.connect(filter);
      filter.connect(audioContext.destination);



      ///////////////////////

      // Request permission for iOS 13+ devices
      if (
        DeviceMotionEvent &&
        typeof DeviceMotionEvent.requestPermission === "function"
      ) {
        DeviceMotionEvent.requestPermission();
      }

      window.addEventListener("deviceorientation", handleOrientation);
      demo_button.remove();
    };

  </script>
</body>

</html>